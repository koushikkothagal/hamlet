"use strict";String.prototype.hashCode=function(){if(Array.prototype.reduce)return this.split("").reduce(function(t,e){return t=(t<<5)-t+e.charCodeAt(0),t&t},0);var t=0;if(0===this.length)return t;for(var e=0;e<this.length;e++){var r=this.charCodeAt(e);t=(t<<5)-t+r,t&=t}return t},angular.module("hamlet",[]).directive("abTest",["HashService",function(t){return{restrict:"A",transclude:!0,scope:{abTestConfig:"@",abTestQualifier:"@"},link:function(e,r,a,n){a.$observe("abTestQualifier",function(){var e=t.calculateBucket(a.abTestQualifier,n.getRatios());n.selectBranch(e)})},controller:function(e){var r=e.panes=[],a=e.ratios=[];this.getRatios=function(){return a},this.selectBranch=function(t){angular.forEach(r,function(t){t.selected=!1}),r[t].selected=!0},this.addPane=function(t){r.push(t),1===r.length&&this.selectBranch(0)},this.readjustRatio=function(r){for(var a=0,n=0;n<=r.length;n++)if("others"===r[n]){r[n]=10-a;var i=t.calculateBucket(e.abTestQualifier,r);this.selectBranch(i)}else a+=1*r[n]},this.addRatio=function(t){var e;"others"===t?(a.push(t),this.readjustRatio(a)):(console.log("ratio: "+t),e=10*parseFloat(t),console.log("ratioToBePushed: "+e),a.push(e))}},template:"<div ng-transclude></div>"}}]).directive("testBranch",function(){return{require:"^abTest",restrict:"A",transclude:!0,scope:{title:"@",ratio:"@"},link:function(t,e,r,a){a.addPane(t),a.addRatio(t.ratio)},template:'<div ng-show="selected" ng-transclude></div>'}}),angular.module("hamlet").factory("HashService",function(){return{getHash:function(t){return new String(t).hashCode()},calculateMod:function(t,e){var r=this.getHash(t),a=r%10;return 0>a&&(a*=-1),a},allocateBucket:function(t,e){var r=e[0];if(r-1>=t)return 0;for(var a=1;a<e.length;a++){if(r-1>=t)return a-1;r+=e[a]}return e.length-1},calculateBucket:function(t,e){var r=this.calculateMod(t,e),a=this.allocateBucket(r,e);return a}}});